# Results

```{r,warning=FALSE,message=FALSE}
library(lubridate)
library(ggplot2)
library(dplyr)
library(tidyr)
library(GGally)
```

##Data Proprocessing
```{r}
#Data Cleansing
data_top5 <- read.csv("NY_wind_percip_top5cities.csv")
```

##Airport Precipitation Monthly Trends
```{r}
Line_data <- data_top5 %>%
  filter(NAME %in% c("LAGUARDIA AIRPORT, NY US", "NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US", "JFK INTERNATIONAL AIRPORT, NY US"))

Line_data$DATE <- as.Date(Line_data$DATE)

# Group by airport and month, then calculate the monthly average
monthly_avg <- Line_data %>%
  group_by(NAME, Month = floor_date(DATE, "month")) %>%
  summarise(AvgPRCP = mean(PRCP, na.rm = TRUE))
# Plotting
ggplot(monthly_avg, aes(x = Month, y = AvgPRCP)) + 
  geom_line() + 
  geom_smooth(method = "loess", se = FALSE, span = 0.8) +
  facet_wrap(~ NAME, scales = "fixed", nrow = 3) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  theme_minimal() +
  labs(title = "Monthly Average Precipitation for Three Airports",
       x = "Month",
       y = "Average Precipitation",
       color = "Airport") +
  theme(legend.position = "none")
```
We are interested in comparing the general monthly precipitation trends of the three airports near New York City. The line graph shows similar patterns between the different airports, which is expected given their geographical proximity. These trends align with the historical weather patterns in the region, where the rainy season in New York typically starts in April and continues until June. However, we can still spot abnormal trends in the graph. Notably, there is a peak in precipitation in September at all three locations, which is usually outside the typical rainy season in New York. These observations align with news reports indicating that the total rainfall in September was the second highest in over 150 years in New York.

Apart from the general precipitation pattern, there are slight variations in the trends between the different airports. With other months being roughly equal, precipitation in September at Newark Airport is significantly lower than at the other two airports. This difference could be attributed to the distinct geographic locations of the airports. LaGuardia and JFK are situated on the same peninsula, unlike Newark, which could account for the disparities in precipitation patterns.

##Relationship between Precipitation, Wind, and Temperature
```{r}
#Branching Experiement
Slope_data <- data_top5 %>%
  filter(NAME %in% c("LAGUARDIA AIRPORT, NY US", "NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US", "JFK INTERNATIONAL AIRPORT, NY US"))

# Group by airport and month, then calculate the monthly average
monthly_avg <- Line_data %>%
  group_by(NAME, Month = floor_date(DATE, "month")) %>%
  summarise(MonthlyPrec = mean(PRCP, na.rm = TRUE), MonthlyWindSpeed = mean(AWND, na.rm = TRUE), MonthlyTempreture= mean(TAVG, na.rm = TRUE))

ggparcoord(monthly_avg, columns=3:5, scale="uniminmax", groupColumn = "NAME") +
  scale_color_discrete(name = "Airport") +
  theme_minimal() +
  labs(title = "Monthly Averages of Wind Speed, Precipitation, and Temperature",
       x = "Variables",
       y = "Normalized Values") +
  theme(legend.position = "bottom")

```

##Heatmap
```{r, fig.width=5, fig.height=9}
# Precipitation VS Wind Speed
Heat_data <- data_top5 %>%
  filter(NAME %in% c("LAGUARDIA AIRPORT, NY US", "NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US", "JFK INTERNATIONAL AIRPORT, NY US"))

# Binning the PRCP and AWND data
Heat_data$Binned_PRCP <- cut(Heat_data$PRCP, breaks = 10)
Heat_data$Binned_AWND <- cut(Heat_data$AWND, breaks = 10)

# Creating a new data frame for the heatmap
heatmap_data <- Heat_data %>%
  group_by(NAME, Binned_PRCP, Binned_AWND) %>%
  summarise(Frequency = n(), .groups = 'drop')  # Counting occurrences

# Plotting the heatmap
ggplot(heatmap_data, aes(x = Binned_AWND, y = Binned_PRCP, fill = Frequency)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  facet_wrap(~ NAME, scales = "free", nrow = 3) +
  labs(title = "Precipitation vs Wind Speed for Three Airports",
       y = "Binned Precipitation (PRCP)",
       x = "Binned Wind Speed (AWND)",
       fill = "Frequency") +
  theme_minimal() +
  theme(legend.position = "right", 
        axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r, fig.width=5, fig.height=9}
# Precipitation VS Temperature

# Binning the PRCP and TAVG data
Heat_data$Binned_PRCP <- cut(Heat_data$PRCP, breaks = 10)
Heat_data$Binned_TAVG <- cut(Heat_data$TAVG, breaks = 10)

# Creating a new data frame for the heatmap
heatmap_data <- Heat_data %>%
  group_by(NAME, Binned_PRCP, Binned_TAVG) %>%
  summarise(Frequency = n(), .groups = 'drop')  # Counting occurrences

# Plotting the heatmap
ggplot(heatmap_data, aes(x = Binned_TAVG, y = Binned_PRCP, fill = Frequency)) +
  geom_tile() +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  facet_wrap(~ NAME, scales = "free", nrow = 3) +
  labs(title = "Precipitation vs Temperature for Three Airports",
       y = "Binned Precipitation (PRCP)",
       x = "Binned Temperature (TAVG)",
       fill = "Frequency") +
  theme_minimal() +
  theme(legend.position = "right", 
        axis.text.x = element_text(angle = 45, hjust = 1))
```


##Scatterplot Matrix
```{r}
sp_data <- data_top5 |> 
  filter(NAME %in% c("LAGUARDIA AIRPORT, NY US", "NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US", "JFK INTERNATIONAL AIRPORT, NY US")) |> 
  filter(!is.na(TAVG) & !is.na(PRCP) & !is.na(AWND)) |> 
  dplyr::select(TAVG, PRCP, AWND, NAME) |> 
  dplyr::rename(
    "Temperature" = TAVG,
    "Precipitation" = PRCP,
    "WindSpeed" = AWND
  )

sp_jfk <- sp_data |> 
  dplyr::filter(NAME == "JFK INTERNATIONAL AIRPORT, NY US") |> 
  dplyr::select(Temperature, Precipitation, WindSpeed)
plot(sp_jfk, pch = 16, cex = .3, main = "Scatterplot Matrix for JFK")

sp_nwk <- sp_data |>
  dplyr::filter(NAME == "NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US") |> 
  dplyr::select(Temperature, Precipitation, WindSpeed)
plot(sp_nwk, pch = 16, cex = .3, main = "Scatterplot Matrix for NWK")

sp_lga <- sp_data |>
  dplyr::filter(NAME == "LAGUARDIA AIRPORT, NY US") |> 
  dplyr::select(Temperature, Precipitation, WindSpeed)
plot(sp_lga, pch = 16, cex = .3, main = "Scatterplot Matrix for LGA")
```
Note that after filtering null values, the remaining airports having enough data for this task are just the following three airports: JFK, LGA and NWK. To compare against each other, we created separate scatter plot matrix, though they have similar distributions.
From the alpha-blended scatter plot matrices of the three selected variables, we observe a potential tri-modal distribution between average temperature and precipitation. It appears that as the temperature increases, precipitation tends to peak in three distinct ranges. Conversely, the relationship between precipitation and average wind speed is less clear. Generally, lower levels of precipitation are observed at extreme wind speeds. However, there is no discernible correlation between average temperature and average wind speed, suggesting these variables may be independent of each other.

##Mosaic
```{r}
categorize_data <- function(data) {
  data |> 
    mutate(
      Temperature = cut(Temperature, breaks = c(-Inf, 45, 55, 65, 75, Inf), labels = c("Very Cold", "Cold", "Mild", "Comfortable", "Hot")),
      Precipitation = cut(Precipitation, breaks = c(-Inf, 0.1, 0.5, 1, Inf), labels = c("No Rain", "Light", "Moderate", "Heavy")),
      WindSpeed = cut(WindSpeed, breaks = c(-Inf, 6, 12, Inf), labels = c("Calm", "Mild", "Windy"))
    )
}

cat_jfk <- categorize_data(sp_jfk)
cat_nwk <- categorize_data(sp_nwk)
cat_lga <- categorize_data(sp_lga)


mosaic(Precipitation ~ Temperature + WindSpeed, data = cat_jfk,  
       direction = c("v", "v", "h"), main = "Combined Mosaic Plot for JFK", rot_labels=c(0,0,90,0), highlighting_fill=c("cyan","lightblue", "cornflowerblue", "navy"))

mosaic(Precipitation ~ Temperature + WindSpeed, data = cat_nwk,  
       direction = c("v", "v", "h"), main = "Combined Mosaic Plot for NWK", rot_labels=c(0,0,90,0), highlighting_fill=c("cyan","lightblue", "cornflowerblue", "navy"))

mosaic(Precipitation ~ Temperature + WindSpeed, data = cat_lga,  
       direction = c("v", "v", "h"), main = "Combined Mosaic Plot for LGA", rot_labels=c(0,0,90,0), highlighting_fill=c("cyan","lightblue", "cornflowerblue", "navy"))
```
In this analysis, we transformed the continuous variables into categorical ones by establishing specific thresholds. Precipitation was designated as the dependent variable, under the hypothesis that it might be influenced by variations in wind speed and temperature.

Regarding the relationship between temperature and precipitation, the data reveals a notable trend: the highest precipitation levels are recorded when temperatures are in the "Mild" range (55-65°F). This pattern is evident in the JFK dataset but is less distinct in the LGA dataset.

When examining the interaction between wind speed and precipitation, the mosaic plots for JFK and LGA display a consistent trend: an increase in wind speed generally correlates with higher levels of precipitation. However, this trend does not apply to the NWK dataset. In NWK, an interesting divergence is observed – at a "Comfortable" temperature range, precipitation levels tend to decrease as wind speed increases, contrasting with the patterns seen in JFK and LGA. This discrepancy highlights the complex and location-specific nature of these environmental variables. 


##Multiple Box-Plot
```{r}
sp_data_abb <- sp_data
sp_data_abb$NAME <- ifelse(sp_data_abb$NAME == "LAGUARDIA AIRPORT, NY US", "LGA", 
                 ifelse(sp_data_abb$NAME == "NEWARK LIBERTY INTERNATIONAL AIRPORT, NJ US", "NWK", "JFK"))


boxplot(Temperature ~ NAME, data = sp_data_abb, main = "Boxplot for Temperature", xlab = "Location", ylab = "Temperature")
boxplot(Precipitation ~ NAME, data = sp_data_abb, main = "Boxplot for Precipitation", xlab = "Location", ylab = "Precipitation")
boxplot(WindSpeed ~ NAME, data = sp_data_abb, main = "Boxplot for Wind Speed", xlab = "Location", ylab = "Wind Speed")
```

From the box plot, it's evident that JFK experiences the lowest median temperature and the highest median wind speed among the three locations. Conversely, NWK exhibits the highest median temperature and the lowest median wind speed. In terms of precipitation, a common trend across all three locations is that a majority of the recorded values are zero. Additionally, the presence of outliers in wind speed across all three locations indicates sporadic occurrences of unusually high wind speeds. This could point to infrequent but significant meteorological events or possibly data recording anomalies.

##Ridgeline
```{r}
library(ggridges)

ggplot(sp_data_abb, aes(x = Temperature, y = NAME, fill = NAME)) +
  geom_density_ridges(alpha = 0.5) +
  labs(title = "Ridgeline Plot for Temperature", x = "Temperature", y = "Location") +
  theme_ridges()

ggplot(sp_data_abb, aes(x = Precipitation, y = NAME, fill = NAME)) +
  geom_density_ridges(alpha = 0.5) +
  labs(title = "Ridgeline Plot for Precipitation", x = "Precipitation", y = "Location") +
  theme_ridges()

ggplot(sp_data_abb, aes(x = WindSpeed, y = NAME, fill = NAME)) +
  geom_density_ridges(alpha = 0.5) +
  labs(title = "Ridgeline Plot for Wind Speed", x = "Wind Speed", y = "Location") +
  theme_ridges()
```

The ridgeline plot analysis largely corroborates the insights gleaned from the boxplot analysis. It reveals that the temperature distributions across all three airports are quite similar, indicating a consistent temperature range. For precipitation, the distributions are heavily skewed to the right, with most values concentrated near zero. This skewness reflects a predominant absence of precipitation, punctuated by occasional higher values. In terms of wind speed, the distribution for NWK is notably more right-skewed compared to JFK and LGA, suggesting a generally lower wind speed at NWK. Additionally, NWK displays a shorter tail in its distribution, indicating fewer instances of extremely high wind speeds compared to the other two airports. This pattern is reflected in NWK's lower median wind speed, as observed in the boxplot analysis.
